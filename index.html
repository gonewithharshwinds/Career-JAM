<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerJAM by MehtaVerse</title>

    <!-- 1. Removed Font Awesome -->
    <!-- 2. Added Google Fonts for Theme & Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400..900&family=Fira+Code:wght@400;500&family=Manrope:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- The new Material Symbols (Variable) import -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <script src="https://cdn.tailwindcss.com"></script>
    <!-- REMOVED: sql.js is no longer needed -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script> -->

    <!-- 3. Integrate Theme directly into Tailwind (Content from themes.html) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'background': 'var(--background)',
                        'foreground': 'var(--foreground)',
                        'card': 'var(--card)',
                        'card-foreground': 'var(--card-foreground)',
                        'popover': 'var(--popover)',
                        'popover-foreground': 'var(--popover-foreground)',
                        'primary': 'var(--primary)',
                        'primary-foreground': 'var(--primary-foreground)',
                        'secondary': 'var(--secondary)',
                        'secondary-foreground': 'var(--secondary-foreground)',
                        'muted': 'var(--muted)',
                        'muted-foreground': 'var(--muted-foreground)',
                        'accent': 'var(--accent)',
                        'accent-foreground': 'var(--accent-foreground)',
                        'destructive': 'var(--destructive)',
                        'destructive-foreground': 'var(--destructive-foreground)',
                        'border': 'var(--border)',
                        'input': 'var(--input)',
                        'ring': 'var(--ring)',
                    },
                    fontFamily: {
                        sans: ['var(--font-sans)', 'sans-serif'],
                        serif: ['var(--font-serif)', 'serif'],
                        mono: ['var(--font-mono)', 'monospace'],
                    },
                    borderRadius: {
                        'lg': 'var(--radius)',
                        'md': 'calc(var(--radius) - 2px)',
                        'sm': 'calc(var(--radius) - 4px)',
                    },
                    boxShadow: {
                        'sm': 'var(--shadow-sm)',
                        'md': 'var(--shadow-md)',
                        'lg': 'var(--shadow-lg)',
                        'xl': 'var(--shadow-xl)',
                        '2xl': 'var(--shadow-2xl)',
                    }
                }
            }
        }
    </script>

    <!-- Styles (Content from themes.html) -->
    <style>
        /* --- Added Theme Variables --- */
        :root {
            --background: #fdf8f5;
            --foreground: #663b49;
            --card: #ffffff;
            --card-foreground: #663b49;
            --popover: #ffffff;
            --popover-foreground: #663b49;
            --primary: #8a4933;
            --primary-foreground: #ffffff;
            --secondary: #dba08b;
            --secondary-foreground: #663b49;
            --muted: #f5ebe6;
            --muted-foreground: #b45f46;
            --accent: #c77961;
            --accent-foreground: #ffffff;
            --destructive: #ff4b4b;
            --destructive-foreground: #ffffff;
            --border: #e0d4cd;
            --input: #f5ebe6;
            --ring: #b45f46;
            --radius: 0.5rem;
            --font-sans: "Manrope", sans-serif;
            --font-serif: "Playfair Display", serif;
            --font-mono: "Fira Code", monospace;
            --shadow-sm: 0 0.25rem 0.5rem 0 hsl(340.4651 26.7081% 31.5686% / 0.10), 0 1px 2px -1px hsl(340.4651 26.7081% 31.5686% / 0.10);
            --shadow-md: 0 0.25rem 0.5rem 0 hsl(340.4651 26.7081% 31.5686% / 0.10), 0 2px 4px -1px hsl(340.4651 26.7081% 31.5686% / 0.10);
            --shadow-lg: 0 0.25rem 0.5rem 0 hsl(340.4651 26.7081% 31.5686% / 0.10), 0 4px 6px -1px hsl(340.4651 26.7081% 31.5686% / 0.10);
            --shadow-xl: 0 0.25rem 0.5rem 0 hsl(340.4651 26.7081% 31.5686% / 0.10), 0 8px 10px -1px hsl(340.4651 26.7081% 31.5686% / 0.10);
            --shadow-2xl: 0 0.25rem 0.5rem 0 hsl(340.4651 26.7081% 31.5686% / 0.25);
        }

        .dark {
            --background: #2e1c24;
            --foreground: #dba08b;
            --card: #3a242c;
            --card-foreground: #dba08b;
            --popover: #3a242c;
            --popover-foreground: #dba08b;
            --primary: #b45f46;
            --primary-foreground: #ffffff;
            --secondary: #663b49;
            --secondary-foreground: #dba08b;
            --muted: #452e36;
            --muted-foreground: #c77961;
            --accent: #8a4933;
            --accent-foreground: #ffffff;
            --destructive: #ff6b6b;
            --destructive-foreground: #ffffff;
            --border: #663b49;
            --input: #2e1c24;
            --ring: #c77961;
            --radius: 0.5rem;
            --font-sans: "Manrope", sans-serif;
            --font-serif: "Playfair Display", serif;
            --font-mono: "Fira Code", monospace;
            --shadow-sm: 0 0.25rem 0.5rem 0 hsl(0 0% 0% / 0.30), 0 1px 2px -1px hsl(0 0% 0% / 0.30);
            --shadow-md: 0 0.25rem 0.5rem 0 hsl(0 0% 0% / 0.30), 0 2px 4px -1px hsl(0 0% 0% / 0.30);
            --shadow-lg: 0 0.25rem 0.5rem 0 hsl(0 0% 0% / 0.30), 0 4px 6px -1px hsl(0 0% 0% / 0.30);
            --shadow-xl: 0 0.25rem 0.5rem 0 hsl(0 0% 0% / 0.30), 0 8px 10px -1px hsl(0 0% 0% / 0.30);
            --shadow-2xl: 0 0.25rem 0.5rem 0 hsl(0 0% 0% / 0.75);
        }
        /* --- End Theme Variables --- */

        /* 4. Base styles for Material Symbols */
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 20;
            vertical-align: bottom; /* Aligns icons with text */
        }

        body {
            font-family: var(--font-sans);
        }

        /* Custom scrollbar updated with theme colors */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: var(--accent);
            }

        .modal {
            display: none;
            opacity: 0; /* NEW: Start modals as transparent */
            transition: opacity 0.3s ease;
        }

            .modal.flex {
                display: flex;
            }

        .modal-content {
            transition: transform 0.3s ease;
        }

        /* Updated custom classes with theme colors */
        .nav-link.active {
            background-color: var(--primary);
            color: var(--primary-foreground);
        }

        .nav-link:not(.active):hover {
            background-color: var(--muted);
        }

        .status-tab.active {
            border-color: var(--primary);
            color: var(--primary);
        }

        .job-row:hover {
            background-color: var(--muted);
        }

        .job-row td[data-field="details"] {
            cursor: pointer;
        }

        td[data-field="notes"] {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

            td[data-field="notes"]:hover {
                background-color: var(--muted);
            }

        .editable-select {
            background-color: var(--input);
            border: 1px solid var(--border);
            color: var(--foreground);
            border-radius: var(--radius);
            padding: 4px 8px;
            width: 100%;
        }

        .analyze-match-btn:disabled, #generate-ai-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Added spin animation for loading icon */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .spin {
            animation: spin 1s linear infinite;
        }

        /* Styles for new Kanban View */
        .view-toggle.active {
            background-color: var(--card);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .kanban-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

            .kanban-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-md);
            }

        /* Fix for Prose colors */
        .prose {
            color: var(--card-foreground);
        }

            .prose strong {
                color: var(--foreground);
            }

            .prose a {
                color: var(--primary);
            }

            .prose code {
                color: var(--accent);
            }

            .prose ul > li::before {
                background-color: var(--muted-foreground);
            }

        /* Styles for column visibility toggle */
        .column-toggle-popover {
            display: none;
            position: absolute;
            z-index: 50;
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 0.5rem;
        }

            .column-toggle-popover.show {
                display: block;
            }

            .column-toggle-popover label {
                display: block;
                padding: 0.25rem 0.5rem;
                border-radius: var(--radius);
                cursor: pointer;
            }

                .column-toggle-popover label:hover {
                    background-color: var(--muted);
                }
        /* NEW: Styles for draggable column items */
        .column-item {
            display: flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            cursor: grab;
            user-select: none;
        }

            .column-item:hover {
                background-color: var(--muted);
            }

            .column-item.dragging {
                opacity: 0.5;
                background-color: var(--secondary);
            }

            .column-item .drag-handle {
                cursor: grab;
                margin-right: 0.5rem;
                color: var(--muted-foreground);
            }

            .column-item .col-priority {
                margin-right: 0.5rem;
                font-size: 0.75rem;
                color: var(--muted-foreground);
                width: 1rem;
            }

            .column-item label {
                flex-grow: 1;
                display: flex;
                align-items: center;
                cursor: pointer;
            }

            .column-item input[type="checkbox"] {
                margin-right: 0.5rem;
            }


        /* Styles for pagination */
        .pagination-controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            padding: 0 0.5rem;
        }

        .pagination-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--card);
            padding: 0.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .pagination-btn {
            background-color: var(--background);
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

            .pagination-btn:hover {
                background-color: var(--muted);
            }

            .pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

        /* Styles for company grid */
        .company-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .company-card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            transition: box-shadow 0.2s ease, transform 0.2s ease;
            cursor: pointer;
        }

            .company-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-md);
            }

        /* NEW: Styles for Related Job Card */
        .related-job-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .related-job-card {
            background-color: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
        }

            .related-job-card h4 {
                font-weight: 600;
                cursor: pointer;
            }

                .related-job-card h4:hover {
                    color: var(--primary);
                }

            .related-job-card p {
                display: flex;
                align-items: center;
                gap: 0.25rem;
                font-size: 0.875rem;
                color: var(--muted-foreground);
                margin-top: 0.5rem;
            }
    </style>
</head>
<body class="bg-background text-foreground font-sans antialiased">
    <div id="app-container" class="flex flex-col h-screen">

        <!-- Header: Refactored with Tailwind theme classes and new icons -->
        <header class="bg-card shadow-md">
            <nav class="container mx-auto px-4 sm:px-6 py-3 flex flex-col sm:flex-row sm:justify-between sm:items-center">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="material-symbols-outlined text-2xl text-primary mr-2">smart_toy</span>
                        <!-- UPDATED: Title -->
                        <h1 class="text-xl font-bold">CareerJAM <span class="text-base font-normal italic opacity-80">by MehtaVerse</span></h1>
                    </div>
                    <!-- Add mobile menu button here if needed -->
                </div>
                <div class="flex items-center space-x-1 sm:space-x-2 mt-2 sm:mt-0 flex-wrap justify-center">
                    <button data-view="jobs-view" class="nav-link flex-col sm:flex-row flex items-center justify-center space-x-0 sm:space-x-1 px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-card focus:ring-ring active">
                        <span class="material-symbols-outlined text-base">work</span>
                        <span>Jobs</span>
                    </button>
                    <button data-view="profiles-view" class="nav-link flex-col sm:flex-row flex items-center justify-center space-x-0 sm:space-x-1 px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-card focus:ring-ring">
                        <span class="material-symbols-outlined text-base">badge</span>
                        <span>Profiles</span>
                    </button>
                    <button data-view="companies-view" class="nav-link flex-col sm:flex-row flex items-center justify-center space-x-0 sm:space-x-1 px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-card focus:ring-ring">
                        <span class="material-symbols-outlined text-base">apartment</span>
                        <span>Companies</span>
                    </button>
                    <button data-view="people-view" class="nav-link flex-col sm:flex-row flex items-center justify-center space-x-0 sm:space-x-1 px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-card focus:ring-ring">
                        <span class="material-symbols-outlined text-base">group</span>
                        <span>People</span>
                    </button>
                    <button data-view="logs-view" class="nav-link flex-col sm:flex-row flex items-center justify-center space-x-0 sm:space-x-1 px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-card focus:ring-ring">
                        <span class="material-symbols-outlined text-base">history</span>
                        <span>Logs</span>
                    </button>
                    <button data-view="settings-view" class="nav-link px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-card focus:ring-ring">
                        <span class="material-symbols-outlined">settings</span>
                    </button>
                </div>
            </nav>
        </header>

        <!-- Main Content: ADDED pb-8 for persistent footer -->
        <main class="flex-grow p-4 overflow-auto pb-8">
            <!-- Jobs View -->
            <div id="jobs-view" class="view-content">
                <!-- Jobs List View -->
                <div id="jobs-list-container">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                        <div class="flex flex-col sm:flex-row items-center gap-4">
                            <!-- Status Tabs (Hidden in Kanban) -->
                            <div id="status-tabs" class="flex space-x-2 border-b border-border overflow-x-auto">
                                <!-- Status tabs will be injected here -->
                            </div>
                            <!-- Sort (Hidden in Kanban) -->
                            <div id="sort-controls" class="pl-0 sm:pl-4 flex items-center gap-4">
                                <select id="sort-jobs-select" class="editable-select text-sm">
                                    <option value="created_at DESC">Sort by: Date (Newest)</option>
                                    <option value="salary DESC">Sort by: Salary (High)</option>
                                    <option value="match_percentage DESC">Sort by: Match % (High)</option>
                                    <option value="title ASC">Sort by: Position (A-Z)</option>
                                    <option value="company_name ASC">Sort by: Company (A-Z)</option>
                                </select>
                                <!-- NEW: Column Visibility Toggle -->
                                <div class="relative">
                                    <button id="manage-columns-btn" class="view-toggle p-2 rounded-md leading-none bg-muted flex items-center gap-2" title="Manage Columns">
                                        <span class="material-symbols-outlined">view_column</span>
                                        <span class="text-sm font-medium">Manage Columns</span>
                                    </button>
                                    <div id="manage-columns-popover" class="column-toggle-popover right-0 mt-2 w-60">
                                        <!-- Draggable column items will be injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <!-- NEW: View Toggle -->
                            <div class="flex items-center space-x-1 p-1 bg-muted rounded-lg">
                                <button id="show-table-view" class="view-toggle active p-2 rounded-md leading-none" title="Table View"><span class="material-symbols-outlined">table_rows</span></button>
                                <button id="show-kanban-view" class="view-toggle p-2 rounded-md leading-none" title="Kanban View"><span class="material-symbols-outlined">view_kanban</span></button>
                            </div>
                            <button id="add-job-btn" class="bg-primary hover:bg-accent text-primary-foreground font-bold py-2 px-4 rounded-lg flex items-center whitespace-nowrap"><span class="material-symbols-outlined mr-2">add</span>Add Job</button>
                        </div>
                    </div>

                    <!-- Jobs Table Container -->
                    <div id="jobs-table-container" class="bg-card rounded-lg shadow-md overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-muted">
                                <!-- Table Head will be injected by JS -->
                            </thead>
                            <tbody id="jobs-table-body" class="divide-y divide-border"></tbody>
                        </table>
                    </div>
                    <!-- NEW: Pagination Controls -->
                    <div id="pagination-controls" class="pagination-controls-container">
                        <div class="pagination-group">
                            <span class="text-sm">Items per page:</span>
                            <select id="items-per-page-select" class="editable-select text-sm w-auto !m-0 !p-1">
                                <option value="5">5</option>
                                <option value="10" selected>10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                        <div class="pagination-group">
                            <span id="page-info" class="text-sm px-2">Page 1 of 1</span>
                            <button id="prev-page-btn" class="pagination-btn"><span class="material-symbols-outlined">chevron_left</span></button>
                            <button id="next-page-btn" class="pagination-btn"><span class="material-symbols-outlined">chevron_right</span></button>
                        </div>
                    </div>

                    <!-- NEW: Jobs Kanban Container -->
                    <div id="jobs-kanban-container" class="hidden">
                        <!-- Kanban board will be injected here by JS -->
                    </div>
                </div>

                <!-- Job Detail View -->
                <div id="job-detail-container" class="hidden">
                    <button id="back-to-jobs-list" class="mb-4 text-sm text-primary hover:underline flex items-center"><span class="material-symbols-outlined mr-1">arrow_back</span>Back to list</button>
                    <div class="flex flex-col lg:flex-row gap-6">
                        <div class="lg:w-2/3 bg-card p-6 rounded-lg shadow-md">
                            <!-- UPDATED: Added wrapper for title and buttons -->
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h2 id="detail-job-title" class="text-2xl font-bold"></h2>
                                    <p id="detail-job-company" class="text-lg text-muted-foreground mb-4"></p>
                                </div>
                                <!-- NEW: Edit and Delete Job Buttons -->
                                <div class="flex space-x-2 flex-shrink-0">
                                    <button id="edit-job-detail-btn" class="p-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg" title="Edit Job">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button id="delete-job-detail-btn" class="p-2 bg-destructive text-destructive-foreground hover:bg-red-700 rounded-lg" title="Delete Job">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </div>
                            </div>
                            <div id="detail-job-description" class="prose max-w-none mb-4"></div>
                            <h3 class="text-lg font-semibold border-t border-border pt-4 mt-4">Notes</h3>
                            <p id="detail-job-notes" class="text-card-foreground whitespace-pre-wrap"></p>
                        </div>
                        <div class="lg:w-1/3 bg-card p-6 rounded-lg shadow-md">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-semibold flex items-center"><span class="material-symbols-outlined text-primary mr-2">smart_toy</span>AI Analysis</h3>
                                <div class="flex items-center space-x-3">
                                    <button id="save-ai-btn" title="Save Analysis" class="text-muted-foreground hover:text-foreground hidden"><span class="material-symbols-outlined">save</span></button>
                                    <button id="generate-ai-btn" title="Generate AI Analysis" class="text-muted-foreground hover:text-foreground"><span class="material-symbols-outlined">auto_awesome</span></button>
                                </div>
                            </div>
                            <div id="ai-detail-panel" class="space-y-4">
                                <!-- AI generated keywords will be injected here -->
                            </div>
                            <div id="ai-match-panel" class="mt-6">
                                <!-- AI match details will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profiles View -->
            <div id="profiles-view" class="view-content hidden">
                <div class="flex justify-end mb-4">
                    <button id="add-profile-btn" class="bg-primary hover:bg-accent text-primary-foreground font-bold py-2 px-4 rounded-lg flex items-center"><span class="material-symbols-outlined mr-2">add</span>Add New Profile</button>
                </div>
                <div class="bg-card rounded-lg shadow-md overflow-hidden">
                    <table class="min-w-full">
                        <thead class="bg-muted">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Profile Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Notes (Click to Edit)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Date Created</th>
                                <!-- NEW: Actions Column -->
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="profiles-table-body" class="divide-y divide-border"></tbody>
                    </table>
                </div>
            </div>

            <!-- Companies View: REBUILT -->
            <div id="companies-view" class="view-content hidden">
                <!-- Grid View (Default) -->
                <div id="company-grid-container">
                    <div class="flex justify-between items-center mb-4 gap-4">
                        <div class="relative flex-grow">
                            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">search</span>
                            <input type="text" id="company-search-input" placeholder="Search companies..." class="bg-input border border-border text-foreground text-sm rounded-lg focus:ring-ring focus:border-ring block w-full p-2.5 pl-10">
                        </div>
                        <button id="add-company-btn" class="bg-primary hover:bg-accent text-primary-foreground font-bold py-2 px-4 rounded-lg flex items-center whitespace-nowrap"><span class="material-symbols-outlined mr-2">add</span>Add Company</button>
                    </div>
                    <div id="company-grid" class="company-grid">
                        <!-- Company cards will be injected here -->
                    </div>
                </div>

                <!-- Company Detail View (Hidden) -->
                <div id="company-detail-container" class="hidden">
                    <button id="back-to-company-grid" class="mb-4 text-sm text-primary hover:underline flex items-center"><span class="material-symbols-outlined mr-1">arrow_back</span>Back to list</button>
                    <div class="flex flex-col lg:flex-row gap-6">
                        <!-- Left Column: Details & AI -->
                        <div class="lg:w-1/3 space-y-6">
                            <div class="bg-card p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">Company Details</h3>
                                <form id="edit-company-form" class="space-y-4">
                                    <input type="hidden" name="id">
                                    <div>
                                        <label class="text-sm font-medium text-muted-foreground">Name</label>
                                        <input type="text" name="name" required class="bg-input border border-border p-2 rounded-lg w-full">
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-muted-foreground">Industry</label>
                                        <input type="text" name="industry" class="bg-input border border-border p-2 rounded-lg w-full">
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-muted-foreground">Location</label>
                                        <input type="text" name="location" class="bg-input border border-border p-2 rounded-lg w-full">
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-muted-foreground">Website</label>
                                        <input type="url" name="website" class="bg-input border border-border p-2 rounded-lg w-full">
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-muted-foreground">LinkedIn</label>
                                        <input type="url" name="linkedin" class="bg-input border border-border p-2 rounded-lg w-full">
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-muted-foreground">Notes</label>
                                        <textarea name="notes" rows="4" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                                    </div>
                                    <button type="submit" class="w-full px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Save Changes</button>
                                    <!-- NEW: Delete Company Button -->
                                    <button type="button" id="delete-company-btn" class="w-full mt-2 px-4 py-2 bg-destructive hover:bg-red-700 text-destructive-foreground rounded-lg font-semibold">Delete Company</button>
                                </form>
                            </div>
                            <div class="bg-card p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">AI Analysis</h3>
                                <button id="run-company-ai-btn" class="w-full px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg font-semibold flex items-center justify-center">
                                    <span class="material-symbols-outlined mr-2">auto_awesome</span>Generate Company Summary
                                </button>
                                <div id="company-ai-output" class="text-sm text-card-foreground mt-4 prose max-w-none">
                                    <!-- AI output will appear here -->
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Related Jobs -->
                        <div class="lg:w-2/3 bg-card p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4">Related Jobs</h3>
                            <div id="related-jobs-list" class="related-job-grid">
                                <!-- Related jobs will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- People View -->
            <div id="people-view" class="view-content hidden">
                <div class="flex justify-end mb-4">
                    <button id="add-person-btn" class="bg-primary hover:bg-accent text-primary-foreground font-bold py-2 px-4 rounded-lg flex items-center"><span class="material-symbols-outlined mr-2">add</span>Add New Contact</button>
                </div>
                <div class="bg-card rounded-lg shadow-md overflow-hidden">
                    <table class="min-w-full">
                        <thead class="bg-muted">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Job Title</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Company</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">LinkedIn</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Notes (Click to Edit)</th>
                                <!-- NEW: Actions Column -->
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="people-table-body" class="divide-y divide-border"></tbody>
                    </table>
                </div>
            </div>

            <!-- Logs View -->
            <div id="logs-view" class="view-content hidden">
                <div class="bg-card rounded-lg shadow-md overflow-hidden">
                    <table class="min-w-full">
                        <thead class="bg-muted">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider w-1/4">Timestamp</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider w-1/6">Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-card-foreground uppercase tracking-wider">Message</th>
                            </tr>
                        </thead>
                        <tbody id="logs-table-body" class="divide-y divide-border"></tbody>
                    </table>
                </div>
            </div>

            <!-- Settings View: REBUILT -->
            <div id="settings-view" class="view-content hidden">
                <div class="max-w-4xl mx-auto space-y-8">
                    <h2 class="text-3xl font-bold text-center">Settings</h2>

                    <!-- Appearance Section -->
                    <div class="bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 flex items-center"><span class="material-symbols-outlined mr-3 text-primary">palette</span>Appearance</h3>
                        <div class="flex items-center justify-between">
                            <label for="theme-select" class="text-sm font-medium">Theme</label>
                            <select id="theme-select" class="editable-select text-sm w-auto max-w-xs">
                                <option value="Humanist Light">Humanist Light</option>
                                <option value="Humanist Dark">Humanist Dark</option>
                            </select>
                        </div>
                    </div>

                    <!-- AI & Automation Section -->
                    <div class="bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 flex items-center"><span class="material-symbols-outlined mr-3 text-primary">smart_toy</span>AI & Automation</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="llm-api-url" class="text-sm font-medium">Local LLM Endpoint</label>
                                <div class="flex items-center space-x-2 mt-1">
                                    <input type="text" id="llm-api-url" class="bg-input border border-border text-foreground text-sm rounded-lg focus:ring-ring focus:border-ring block w-full p-2.5" placeholder="http://localhost:1234/v1/chat/completions">
                                    <button id="test-connection-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">Test</button>
                                </div>
                                <p class="text-xs text-muted-foreground mt-2">See "About" section for setup instructions.</p>
                            </div>
                            <div class="flex items-center justify-between mt-4">
                                <label for="auto-create-company-toggle" class="text-sm font-medium">Auto-create new companies from jobs</label>
                                <input type="checkbox" id="auto-create-company-toggle" class="h-4 w-4 rounded border-border text-primary focus:ring-primary">
                            </div>
                        </div>
                    </div>

                    <!-- Data Management Section -->
                    <div class="bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 flex items-center"><span class="material-symbols-outlined mr-3 text-primary">database</span>Data Management</h3>
                        <p class="text-xs text-muted-foreground bg-background p-2 rounded-md mb-4">
                            <strong>Important:</strong> All data is stored locally in your browser. Create regular manual backups for safety.
                        </p>
                        <div class="flex space-x-4">
                            <button id="backup-db-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center"><span class="material-symbols-outlined mr-2">download</span>Backup DB</button>
                            <label class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg cursor-pointer flex items-center justify-center">
                                <span class="material-symbols-outlined mr-2">upload</span>Restore DB
                                <input type="file" id="restore-db-input" class="hidden" accept=".json"> <!-- UPDATED: Accept JSON -->
                            </label>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 flex items-center"><span class="material-symbols-outlined mr-3 text-primary">info</span>About & Help</h3>
                        <div class="prose max-w-none">
                            <h4 class="font-semibold">How to Run Local LLM</h4>
                            <ol>
                                <li>Download & install <a href="https://lmstudio.ai/" target="_blank">LM Studio</a> for your OS.</li>
                                <li>In LM Studio, search for and download a small, fast model. We recommend: <code>gemma-2b-it-q4_0.gguf</code> (~2.5GB).</li>
                                <li>Go to the <span class="material-symbols-outlined" style="font-size: 1.2em; vertical-align: -3px;">database</span> Local Server tab, select your downloaded model, and click <strong style="color: #4ade80;">Start Server</strong>.</li>
                                <li>Copy the server URL (usually <code>http://localhost:1234/v1</code>) and paste it in the AI settings.</li>
                            </ol>
                            <h4 class="font-semibold mt-6">Credits</h4>
                            <p>
                                This application was brought to life by <a href="https://mehtaharsh.xyz" target="_blank">Harsh Mehta</a>.<br>
                                Download App : <a>https://careerjam.mehtaharsh.xyz/download</a><br>
                                Hosted using Github & Netlify
                            </p>
                            <p class="text-xs text-muted-foreground opacity-70 mt-4">v0.2.1 (merge-fix)</p>
                        </div>
                    </div>

                </div>
            </div>

        </main>

        <!-- UPDATED: Persistent Footer -->
        <footer id="status-footer" class="bg-card text-center py-1 px-4 text-sm text-muted-foreground border-t border-border z-10 transition-all duration-300">
            Status message goes here
        </footer>
    </div>

    <!-- Modals -->
    <div id="add-job-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Add a New Job Post</h3>
            <form id="add-job-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- NEW: Hidden input for editing -->
                    <input type="hidden" name="id">
                    <input type="text" name="title" placeholder="Job Title" required class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="company_name" placeholder="Company Name" required class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="location" placeholder="Location" class="bg-input border border-border p-2 rounded-lg">
                    <input type="number" step="0.1" name="salary" placeholder="Max Salary (e.g., 15 for â‚¹15 LPA)" class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="url" placeholder="URL for Original Posting" class="md:col-span-2 bg-input border border-border p-2 rounded-lg">
                </div>
                <div class="mt-4">
                    <textarea name="description" placeholder="Job Description" rows="8" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-4">
                    <textarea name="notes" placeholder="Notes about this job..." rows="3" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Save Job</button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-company-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Add a New Company</h3>
            <form id="add-company-form">
                <div class="space-y-4">
                    <input type="text" name="name" placeholder="Name" required class="bg-input border border-border p-2 rounded-lg w-full">
                    <input type="text" name="industry" placeholder="Industry" class="bg-input border border-border p-2 rounded-lg w-full">
                    <input type="text" name="location" placeholder="Location" class="bg-input border border-border p-2 rounded-lg w-full">
                    <input type="url" name="website" placeholder="Website" class="bg-input border border-border p-2 rounded-lg w-full">
                    <input type="url" name="linkedin" placeholder="LinkedIn Profile" class="bg-input border border-border p-2 rounded-lg w-full">
                    <textarea name="notes" placeholder="Notes about this company..." rows="3" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Save Company</button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-person-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Add a New Contact</h3>
            <form id="add-person-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="first_name" placeholder="First Name" required class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="last_name" placeholder="Last Name" required class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="job_title" placeholder="Job Title" class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="company_name" placeholder="Company Name" class="bg-input border border-border p-2 rounded-lg">
                    <input type="email" name="email" placeholder="Email" class="bg-input border border-border p-2 rounded-lg">
                    <input type="url" name="linkedin" placeholder="LinkedIn Profile" class="bg-input border border-border p-2 rounded-lg">
                </div>
                <div class="mt-4">
                    <textarea name="notes" placeholder="Notes about this contact..." rows="3" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Save Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Edit Person Modal -->
    <div id="edit-person-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Edit Contact</h3>
            <form id="edit-person-form">
                <input type="hidden" name="id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="first_name" placeholder="First Name" required class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="last_name" placeholder="Last Name" required class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="job_title" placeholder="Job Title" class="bg-input border border-border p-2 rounded-lg">
                    <input type="text" name="company_name" placeholder="Company Name" class="bg-input border border-border p-2 rounded-lg">
                    <input type="email" name="email" placeholder="Email" class="bg-input border border-border p-2 rounded-lg">
                    <input type="url" name="linkedin" placeholder="LinkedIn Profile" class="bg-input border border-border p-2 rounded-lg">
                </div>
                <div class="mt-4">
                    <textarea name="notes" placeholder="Notes about this contact..." rows="3" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Update Contact</button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-profile-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Add New Profile</h3>
            <form id="add-profile-form">
                <div class="space-y-4">
                    <input type="text" name="name" placeholder="Profile Name (e.g., 'Senior Developer Resume')" required class="bg-input border border-border p-2 rounded-lg w-full">
                    <textarea name="content" placeholder="Paste your full resume/CV text here..." rows="12" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                    <textarea name="notes" placeholder="Notes about this profile..." rows="3" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Save Profile</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Edit Profile</h3>
            <form id="edit-profile-form">
                <input type="hidden" name="id">
                <div class="space-y-4">
                    <input type="text" name="name" placeholder="Profile Name (e.g., 'Senior Developer Resume')" required class="bg-input border border-border p-2 rounded-lg w-full">
                    <textarea name="content" placeholder="Paste your full resume/CV text here..." rows="12" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                    <textarea name="notes" placeholder="Notes about this profile..." rows="3" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Update Profile</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-notes-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-lg transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Edit Notes</h3>
            <form id="edit-notes-form">
                <input type="hidden" name="itemId">
                <input type="hidden" name="itemType">
                <textarea name="notes" id="notes-editor" rows="8" class="bg-input border border-border p-2 rounded-lg w-full"></textarea>

                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-accent text-primary-foreground rounded-lg font-semibold">Save Notes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Confirm Delete Modal -->
    <div id="confirm-delete-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="modal-content bg-card rounded-lg shadow-xl p-6 w-full max-w-sm transform scale-95">
            <h3 class="text-xl font-semibold mb-4">Are you sure?</h3>
            <p id="delete-confirmation-text" class="text-card-foreground mb-6">Do you really want to delete this item? This action cannot be undone.</p>
            <!-- Hidden inputs to store item info -->
            <input type="hidden" id="delete-item-id">
            <input type="hidden" id="delete-item-type">
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" class="cancel-modal-btn px-4 py-2 bg-secondary text-secondary-foreground hover:bg-muted rounded-lg">Cancel</button>
                <button type="button" id="confirm-delete-btn" class="px-4 py-2 bg-destructive hover:bg-red-700 text-destructive-foreground rounded-lg font-semibold">Yes, Delete</button>
            </div>
        </div>
    </div>


    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50 hidden">
        <div class="text-primary-foreground text-xl flex items-center">
            <span class="material-symbols-outlined spin mr-3">progress_activity</span>
            <span id="loading-text">Loading Database...</span>
        </div>
    </div>

    <!-- Load application logic -->
    <script src="functions.js"></script>
</body>
</html>
